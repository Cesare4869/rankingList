# 基于Golang和Redis的排行版服务实现  
  
## 排行榜具体功能设计  

1. 添加成员  
2. 查看榜中成员的分数  
3. 查看榜中成员的排名  
4. 查看榜中成员的反向排名  
5. 查看榜中成员数量  
6. 查看榜中前n名的成员  
7. 查看榜中前n名的成员及分数  
8. 查看榜中反向n名的成员  
9. 查看榜中反向n名的成员及分数  


## 排行榜代码结构设计  
  
  使用redis zset, score 为整形变量（取反排序）；得分相同时按时间先后排序：

  ```  
  用户ID：id,  
  用户分数：score,
  用户排名：ranking  
  ```  

  (暂不考虑)
  设计一个分数 = score + 时间戳（时间越小。其值应该越大），整数部分存储score，小数部分存时间戳（使用最大值减去它）：  

  分数 = score + （Interger.MAX - 时间戳） * 10^-13
  
  使用redigo设计API接口  


## 测试设计  

    设计排行榜redis key名称：  
    ``` 	key := "rankList:test"   ```
      
    生成rankList实例：  
    ``` rankList, err := New(rds, key) ```  

    插入三条数据并测试：  
      
    ```
    score, err := rankList.Update(ctx, uid, 100)
	require.Nil(t, err)

	score1, err := rankList.Update(ctx, uid-1, 200)
	require.Nil(t, err)

	score2, err := rankList.Update(ctx, uid+1, 50)
	require.Nil(t, err)
	t.Logf("score:%v, score1:%v, score2:%v", score, score1, score2)  
    ```  

    查验排行榜总数：  
    ```
    total := rankList.GetTotalCount(ctx)
	require.Equal(t, int64(3), total)
    ```  
      
    检查获取排行榜前n名（正向反向）：  
    ```  
    list, err = rankList.GetRankingList(ctx, 4, true)
	require.Nil(t, err)
	require.Len(t, list, 3)

	list, err = rankList.GetRankingList(ctx, 2, true)
	require.Nil(t, err)
	require.Len(t, list, 2)

	list, err = rankList.GetRankingList(ctx, 3, false)
	require.Nil(t, err)
	require.Len(t, list, 3)
	require.Equal(t, uid-1, list[2].UID)
	require.Equal(t, uid, list[1].UID)
	require.Equal(t, uid+1, list[0].UID)
    ```  
    检查获取单一排行榜成员的排名及分数：  
    ```  
    ur, err := rankList.GerUserRank(ctx, uid, true)
	require.Nil(t, err)
	require.Equal(t, int64(2), ur)
	uv, err := rankList.GetUserVal(ctx, uid)
	require.Nil(t, err)
	require.Equal(t, int64(100), uv)

	ur, err = rankList.GerUserRank(ctx, uid+1, true)
	require.Nil(t, err)
	require.Equal(t, int64(3), ur)
	uv, err = rankList.GetUserVal(ctx, uid+1)
	require.Nil(t, err)
	require.Equal(t, int64(50), uv)

	ur, err = rankList.GerUserRank(ctx, uid-1, false)
	require.Nil(t, err)
	require.Equal(t, int64(3), ur)
	uv, err = rankList.GetUserVal(ctx, uid-1)
	require.Nil(t, err)
	require.Equal(t, int64(200), uv)  
    ```  




## 客户端设计  
